<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>博客搭建 | xiaohong知识库</title>
    <meta name="generator" content="VuePress 1.9.10">
    <link rel="icon" href="/knowledge_base/img/logo-2.png">
    <meta name="description" content="知识库就像是一座蕴藏着无尽智慧的宝库，它全面且细致地记录着工作中各种各样的技术要点，无论是先进的科技成果还是实用的操作技巧都能在这里找到它们的踪迹。">
    <meta name="keywords" content="前端博客,个人技术博客,前端,前端开发,前端框架,web前端,前端面试题,技术文档,学习,面试,JavaScript,js,ES6,TypeScript,vue,python,css3,html5,Node,git,github,markdown">
    <meta name="theme-color" content="#11a8cd">
    
    <link rel="preload" href="/knowledge_base/assets/css/0.styles.77f06b6a.css" as="style"><link rel="preload" href="/knowledge_base/assets/js/app.abb6159b.js" as="script"><link rel="preload" href="/knowledge_base/assets/js/3.5aff290e.js" as="script"><link rel="preload" href="/knowledge_base/assets/js/2.a12c3dd1.js" as="script"><link rel="preload" href="/knowledge_base/assets/js/9.7865277d.js" as="script"><link rel="prefetch" href="/knowledge_base/assets/js/1.57f16cad.js"><link rel="prefetch" href="/knowledge_base/assets/js/10.558d940e.js"><link rel="prefetch" href="/knowledge_base/assets/js/11.99eeb2a7.js"><link rel="prefetch" href="/knowledge_base/assets/js/12.4d7363a4.js"><link rel="prefetch" href="/knowledge_base/assets/js/13.01371b0e.js"><link rel="prefetch" href="/knowledge_base/assets/js/14.0974298b.js"><link rel="prefetch" href="/knowledge_base/assets/js/15.ed6370bf.js"><link rel="prefetch" href="/knowledge_base/assets/js/16.3d3a17e2.js"><link rel="prefetch" href="/knowledge_base/assets/js/17.9f3abe6e.js"><link rel="prefetch" href="/knowledge_base/assets/js/18.455d08dd.js"><link rel="prefetch" href="/knowledge_base/assets/js/19.f3b021b6.js"><link rel="prefetch" href="/knowledge_base/assets/js/20.50ac8d5a.js"><link rel="prefetch" href="/knowledge_base/assets/js/21.0428c2fa.js"><link rel="prefetch" href="/knowledge_base/assets/js/22.53039d18.js"><link rel="prefetch" href="/knowledge_base/assets/js/23.4a979e4c.js"><link rel="prefetch" href="/knowledge_base/assets/js/24.bf03a44f.js"><link rel="prefetch" href="/knowledge_base/assets/js/25.16b80667.js"><link rel="prefetch" href="/knowledge_base/assets/js/26.66351b34.js"><link rel="prefetch" href="/knowledge_base/assets/js/27.ba7c09ad.js"><link rel="prefetch" href="/knowledge_base/assets/js/28.1f68e348.js"><link rel="prefetch" href="/knowledge_base/assets/js/29.6b7a4c61.js"><link rel="prefetch" href="/knowledge_base/assets/js/30.7e2a3ec9.js"><link rel="prefetch" href="/knowledge_base/assets/js/31.0ceec2e1.js"><link rel="prefetch" href="/knowledge_base/assets/js/32.d802836b.js"><link rel="prefetch" href="/knowledge_base/assets/js/33.8b796ea8.js"><link rel="prefetch" href="/knowledge_base/assets/js/34.2c76604a.js"><link rel="prefetch" href="/knowledge_base/assets/js/35.620fe77c.js"><link rel="prefetch" href="/knowledge_base/assets/js/36.d92e5d5a.js"><link rel="prefetch" href="/knowledge_base/assets/js/37.41761db2.js"><link rel="prefetch" href="/knowledge_base/assets/js/38.45deacf2.js"><link rel="prefetch" href="/knowledge_base/assets/js/39.13be272d.js"><link rel="prefetch" href="/knowledge_base/assets/js/4.aaf2098c.js"><link rel="prefetch" href="/knowledge_base/assets/js/40.f4055c8c.js"><link rel="prefetch" href="/knowledge_base/assets/js/41.6e638eee.js"><link rel="prefetch" href="/knowledge_base/assets/js/42.ec09572d.js"><link rel="prefetch" href="/knowledge_base/assets/js/43.d331b0a0.js"><link rel="prefetch" href="/knowledge_base/assets/js/44.e6773fb2.js"><link rel="prefetch" href="/knowledge_base/assets/js/45.5f0dd7ff.js"><link rel="prefetch" href="/knowledge_base/assets/js/46.5082a3a5.js"><link rel="prefetch" href="/knowledge_base/assets/js/47.7d951c95.js"><link rel="prefetch" href="/knowledge_base/assets/js/48.70e02ba5.js"><link rel="prefetch" href="/knowledge_base/assets/js/49.e43b5c83.js"><link rel="prefetch" href="/knowledge_base/assets/js/5.ee14aa6c.js"><link rel="prefetch" href="/knowledge_base/assets/js/50.0c96b1ed.js"><link rel="prefetch" href="/knowledge_base/assets/js/51.19f1ce4d.js"><link rel="prefetch" href="/knowledge_base/assets/js/52.41115ec6.js"><link rel="prefetch" href="/knowledge_base/assets/js/53.9f5707b4.js"><link rel="prefetch" href="/knowledge_base/assets/js/54.dc33b5cd.js"><link rel="prefetch" href="/knowledge_base/assets/js/55.3579c5f5.js"><link rel="prefetch" href="/knowledge_base/assets/js/56.f731f543.js"><link rel="prefetch" href="/knowledge_base/assets/js/57.0080d596.js"><link rel="prefetch" href="/knowledge_base/assets/js/58.41b34d27.js"><link rel="prefetch" href="/knowledge_base/assets/js/59.dead1db5.js"><link rel="prefetch" href="/knowledge_base/assets/js/6.c68a63de.js"><link rel="prefetch" href="/knowledge_base/assets/js/60.fa021d53.js"><link rel="prefetch" href="/knowledge_base/assets/js/61.17400b94.js"><link rel="prefetch" href="/knowledge_base/assets/js/62.e7e55e2d.js"><link rel="prefetch" href="/knowledge_base/assets/js/63.10fec1e7.js"><link rel="prefetch" href="/knowledge_base/assets/js/64.c91409ae.js"><link rel="prefetch" href="/knowledge_base/assets/js/65.4aae85b7.js"><link rel="prefetch" href="/knowledge_base/assets/js/66.4d3cbedf.js"><link rel="prefetch" href="/knowledge_base/assets/js/67.f64b08f2.js"><link rel="prefetch" href="/knowledge_base/assets/js/68.5618553c.js"><link rel="prefetch" href="/knowledge_base/assets/js/69.f148799e.js"><link rel="prefetch" href="/knowledge_base/assets/js/70.f025f639.js"><link rel="prefetch" href="/knowledge_base/assets/js/71.b2a5b16c.js"><link rel="prefetch" href="/knowledge_base/assets/js/72.59f774bc.js"><link rel="prefetch" href="/knowledge_base/assets/js/73.df2f2ee8.js"><link rel="prefetch" href="/knowledge_base/assets/js/74.fe912629.js"><link rel="prefetch" href="/knowledge_base/assets/js/75.94c8c1db.js"><link rel="prefetch" href="/knowledge_base/assets/js/76.6a671ffd.js"><link rel="prefetch" href="/knowledge_base/assets/js/77.5bfd0cb8.js"><link rel="prefetch" href="/knowledge_base/assets/js/78.a22aab1a.js"><link rel="prefetch" href="/knowledge_base/assets/js/79.cff1b2c8.js"><link rel="prefetch" href="/knowledge_base/assets/js/80.dc423fce.js"><link rel="prefetch" href="/knowledge_base/assets/js/81.da9ed67c.js"><link rel="prefetch" href="/knowledge_base/assets/js/82.2a92c14b.js"><link rel="prefetch" href="/knowledge_base/assets/js/83.92caeb87.js"><link rel="prefetch" href="/knowledge_base/assets/js/84.6eba7677.js"><link rel="prefetch" href="/knowledge_base/assets/js/85.ad7374dd.js"><link rel="prefetch" href="/knowledge_base/assets/js/vendors~docsearch.52c99b89.js">
    <link rel="stylesheet" href="/knowledge_base/assets/css/0.styles.77f06b6a.css">
  </head>
  <body class="theme-mode-light">
    <div id="app" data-server-rendered="true"><div class="theme-container sidebar-open have-rightmenu"><header class="navbar blur"><div title="目录" class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/knowledge_base/" class="home-link router-link-active"><img src="/knowledge_base/img/EB-logo.png" alt="xiaohong知识库" class="logo"> <span class="site-name can-hide">xiaohong知识库</span></a> <div class="links"><div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/knowledge_base/" class="nav-link">首页</a></div><div class="nav-item"><a href="/knowledge_base/Embedded/" class="nav-link">嵌入式</a></div><div class="nav-item"><a href="/knowledge_base/web/" class="nav-link">前端</a></div><div class="nav-item"><a href="/knowledge_base/backEnd/" class="nav-link">后端</a></div><div class="nav-item"><a href="/knowledge_base/examination/" class="nav-link">考试</a></div><div class="nav-item"><a href="/knowledge_base/tourism/" class="nav-link">旅行</a></div><div class="nav-item"><a href="/knowledge_base/archives/" class="nav-link">归档</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/knowledge_base/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/knowledge_base/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/knowledge_base/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/knowledge_base/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/XIAOHONGHUB/knowledge_base" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav></div></header> <div class="sidebar-mask"></div> <div class="sidebar-hover-trigger"></div> <aside class="sidebar" style="display:none;"><!----> <nav class="nav-links"><div class="nav-item"><a href="/knowledge_base/" class="nav-link">首页</a></div><div class="nav-item"><a href="/knowledge_base/Embedded/" class="nav-link">嵌入式</a></div><div class="nav-item"><a href="/knowledge_base/web/" class="nav-link">前端</a></div><div class="nav-item"><a href="/knowledge_base/backEnd/" class="nav-link">后端</a></div><div class="nav-item"><a href="/knowledge_base/examination/" class="nav-link">考试</a></div><div class="nav-item"><a href="/knowledge_base/tourism/" class="nav-link">旅行</a></div><div class="nav-item"><a href="/knowledge_base/archives/" class="nav-link">归档</a></div><div class="nav-item"><div class="dropdown-wrapper"><button type="button" aria-label="索引" class="dropdown-title"><a href="/knowledge_base/archives/" class="link-title">索引</a> <span class="title" style="display:none;">索引</span> <span class="arrow right"></span></button> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/knowledge_base/categories/" class="nav-link">分类</a></li><li class="dropdown-item"><!----> <a href="/knowledge_base/tags/" class="nav-link">标签</a></li><li class="dropdown-item"><!----> <a href="/knowledge_base/archives/" class="nav-link">归档</a></li></ul></div></div> <a href="https://github.com/XIAOHONGHUB/knowledge_base" target="_blank" rel="noopener noreferrer" class="repo-link">
    GitHub
    <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></nav>  <ul class="sidebar-links"><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading open"><span>知识库搭建</span> <span class="arrow down"></span></p> <ul class="sidebar-links sidebar-group-items"><li><a href="/knowledge_base/pages/41f87d89d0d0a02af/" aria-current="page" class="active sidebar-link">博客搭建</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level2"><a href="/knowledge_base/pages/41f87d89d0d0a02af/#一、环境配置" class="sidebar-link">一、环境配置：</a></li><li class="sidebar-sub-header level2"><a href="/knowledge_base/pages/41f87d89d0d0a02af/#二、知识库运行原理" class="sidebar-link">二、知识库运行原理</a></li><li class="sidebar-sub-header level2"><a href="/knowledge_base/pages/41f87d89d0d0a02af/#三、将本地vuepress代码传到gitea仓库" class="sidebar-link">三、将本地vuepress代码传到gitea仓库</a></li><li class="sidebar-sub-header level2"><a href="/knowledge_base/pages/41f87d89d0d0a02af/#四、服务器环境安装" class="sidebar-link">四、服务器环境安装</a></li><li class="sidebar-sub-header level2"><a href="/knowledge_base/pages/41f87d89d0d0a02af/#五、测试" class="sidebar-link">五、测试</a><ul class="sidebar-sub-headers"><li class="sidebar-sub-header level3"><a href="/knowledge_base/pages/41f87d89d0d0a02af/#_1、流程流通性测试" class="sidebar-link">1、流程流通性测试</a></li><li class="sidebar-sub-header level3"><a href="/knowledge_base/pages/41f87d89d0d0a02af/#_2、项目在服务器构建测试" class="sidebar-link">2、项目在服务器构建测试</a></li></ul></li></ul></li><li><a href="/knowledge_base/pages/41f87d89089a02af/" class="sidebar-link">知识上传知识库教程</a></li></ul></section></li><li><section class="sidebar-group collapsable depth-0"><p class="sidebar-heading"><span>vscode功能优化</span> <span class="arrow right"></span></p> <!----></section></li><li><a href="/knowledge_base/pages/048d93/" class="sidebar-link">个人时间</a></li></ul> </aside> <div><main class="page"><div class="theme-vdoing-wrapper "><div class="articleInfo-wrap" data-v-06225672><div class="articleInfo" data-v-06225672><ul class="breadcrumbs" data-v-06225672><li data-v-06225672><a href="/knowledge_base/" title="首页" class="iconfont icon-home router-link-active" data-v-06225672></a></li> <li data-v-06225672><a href="/knowledge_base/knowledgeBase/#知识库" data-v-06225672>知识库</a></li><li data-v-06225672><a href="/knowledge_base/knowledgeBase/#知识库搭建" data-v-06225672>知识库搭建</a></li></ul> <div class="info" data-v-06225672><!----> <div title="创建时间" class="date iconfont icon-riqi" data-v-06225672><a href="javascript:;" data-v-06225672>2024-08-30</a></div> <!----></div></div></div> <!----> <div class="content-wrapper"><div class="right-menu-wrapper"><div class="right-menu-margin"><div class="right-menu-title">目录</div> <div class="right-menu-content"></div></div></div> <h1><img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAB4AAAAeCAYAAAA7MK6iAAAAAXNSR0IArs4c6QAABKFJREFUSA3tVl1oFVcQnrMbrak3QUgkya1akpJYcrUtIqW1JvFBE9LiQ5v6JmJpolbMg32rVrhgoYK0QiMY6i9Y6EMaW5D+xFJaTYItIuK2Kr3+BJNwkxBj05sQY3b3nM6cs2dv9t7NT/vQJw/sndk5M/PNzJkzewGerP+pAmy+ON8lLzUJgA8ZYxYIYZmGYRnctDaWvJJAmTtfP1pvXsBCCPP8QFcCaRkZYACgDZFO4stNIcBCajEOlmmC9XpJ9bAGCaPaPmzPl32dvLSVu3BWCTQs0XQQ6g0DYgwLIoAZbBCdW/i+781o1VVlm/410mw4h06Y7bIPHNyWDyL4FHkX03Q8SrzNhZTZriieckWt7cL6MM85YcLpsi/7O9/iXFT6MswI0DmmpkSaJ0qLxFIm3+i1THHB3zmBH3PYx9CcykcLOeQVVa7QtdxTgQgEleX2AjHYfwA+2ddV77ruGoJUbhGDI09YSNXyMpUt5ylOzxgbUmtOp7NmbNt8v3arjTBfYELmLUV+M+nSawNNAUqpT3ClJWg5I3BLT+cGW/DXNGCa6tx1aakCGEigArTn4TDIPdrXXYKCZNrHLMCOEPvHBlLQ99s9eHB7EB6NTki73CVPQ2F5MSx/uRQixfmq7rK0wYD8w8E905bnPDfwoWs/rfv93NWN/ZfvwsLIU7A09gxECyISeGJkHAau98L97tuw7NXnoPyNF8FcYGLGKsOs0mN3OEyec9esGW/ZEl945dTP34wlR2FZVQWU1q0Cw8Tr7p+hgLLNL0FPxx/Q35mA8aEUrH6nCgwEl0tn7wUiZYJnNRh6DK4UH/k0lfyrsBKdPVv/AriGIQcEDQZ65LBAGe2Rzui9Ybjz7XUppz1/uKBbyVPGkN3ZAeC6hr0x7Nr38N5+EqkoOm17xpoqR9ohQF55ERSvr4Dkr3chNfC3DMzGJlNBElW8w9nsGQvhNGIzDkXzCg8cLK951xHsFBlTJspJNi3ZFIMF2AeDV3q8DNOB+YHi6QTrChDIWDBRi5U5f+ZMfJLu3ccrqxtdxk4SKH336LFxSmkqefwU5T8fhdSdQf9IVKD6aNiwI/hnmcAZ91isYMJIaCUCx9W098+LgruikeTqzqqxKPUwqJyCPJiyemVVZBOijDGjD38Os0jOiSPL1z3SPjXNANbiNPXAdzTfukjjuknNBbyz3nwgTd3AVFqUJ5hpHlq9MveLnWwttUfoygBmvVjuikxND3znrhsELnZk7k+OjIGxeNEkomyLVta0xxn+HZhjBc4YZ/AFjHjz9u3xRZl2BN4aq9nFwWh16IrQ1aHHEd3j1+4/dB9OtH4e29A2H1DyHQRmOSfQZ1Fy7MHBTGB6J/Djq6p3OxyO2cB+4Car7v/o3GXgfAkj23+x9ID1Teoamo/SXcbvSf2PX7Vc8DdCmE1vN9di+32P9/5YR3vLnhCVGUWBjEkr3yh4H8v9CzmsbdhzOKzsJKM90iFdaTMjRPhGVsakRvOaRidljo6H6G7j+ctrJpsP+4COhDIl0La2+FS4+5mlocBaXY5QnGZysIBYoeSsl5qQzrSj/cgNrfuEzlWBfwA+EjrZyWUvpAAAAABJRU5ErkJggg==">博客搭建<!----></h1> <!----> <div class="theme-vdoing-content content__default"><h1 id="知识库搭建笔记"><a href="#知识库搭建笔记" class="header-anchor">#</a> 知识库搭建笔记</h1> <p>时间：2024年8月22日</p> <p>作者：罗佳鸿</p> <p>搭建须知：由于docker目前很多的镜像源库在中国已经停止服务了，所以在使用docker拉取droneCI的时候会出现拉取超时的问题。如果项目中不希望使用docker进行应用管理，无需继续往下看。如果执意选择docker安装，在docker拉取镜像超时时，可以去网上多尝试不同的镜像源。目前国内还有部分docker镜像能用。</p> <h2 id="一、环境配置"><a href="#一、环境配置" class="header-anchor">#</a> 一、环境配置：</h2> <table><thead><tr><th>名称</th> <th>版本号</th></tr></thead> <tbody><tr><td>操作系统</td> <td>openEuler</td></tr> <tr><td>docker版本</td> <td>v26.1.3</td></tr> <tr><td>nginx版本</td> <td>v1.21.5</td></tr> <tr><td>docker-compose版本</td> <td>v2.29.2</td></tr> <tr><td>node</td> <td>v20.16.0</td></tr> <tr><td>git</td> <td>v2.40.0.rc0.windows.1</td></tr></tbody></table> <h2 id="二、知识库运行原理"><a href="#二、知识库运行原理" class="header-anchor">#</a> 二、知识库运行原理</h2> <p><img src="/knowledge_base/assets/img/image-20240827104036095.1b3a45ec.png" alt="image-20240827104036095"></p> <details class="custom-block details"><summary>SQL语句释义</summary> <p>知识库采用droneCI为主线技术。</p> <p>DroneCI 的工作原理是本地代码提交到 Gitea 后，Gitea 通过 webhook 通知 Drone Server。Drone Server 接收到通知后，会触发相应的 pipeline，运行定义好的构建任务。这些任务由 Runner 执行，Runner 会去gitea拉取代码并在指定环境中进行构建和测试。</p></details> <h2 id="三、将本地vuepress代码传到gitea仓库"><a href="#三、将本地vuepress代码传到gitea仓库" class="header-anchor">#</a> 三、将本地vuepress代码传到gitea仓库</h2> <h4 id="_1、创建vuepress-starter项目"><a href="#_1、创建vuepress-starter项目" class="header-anchor">#</a> 1、创建vuepress-starter项目</h4> <p>​	通过gitbash在本地创建vuepress-starter项目【vuepress的默认项目】，这是自动拉取方式，如果拉取不下来，可以尝试手动拉取，参考地址：<a href="https://vuepress.vuejs.org/zh/guide/getting-started.html#%E4%BE%9D%E8%B5%96%E7%8E%AF%E5%A2%83" target="_blank" rel="noopener noreferrer">快速上手 | VuePress (vuejs.org)<span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></p> <p><img src="/knowledge_base/assets/img/image-20240827104106307.7c71fbba.png" alt="image-20240827104106307"></p> <div class="language- line-numbers-mode"><pre class="language-text"><code>npm init vuepress vuepress-starter
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><hr> <p><img src="/knowledge_base/assets/img/image-20240827104239322.6b1b1906.png" alt="image-20240827104239322"></p> <p><img src="/knowledge_base/assets/img/image-20240827104308234.a75ff634.png" alt="image-20240827104308234"></p> <p><img src="/knowledge_base/assets/img/image-20240827104328730.aeb9f122.png" alt="image-20240827104328730"></p> <p><img src="/knowledge_base/assets/img/image-20240827104351434.ff494a54.png" alt="image-20240827104351434"></p> <h4 id="_2、vuepress-starter项目中添加-drone-yml文件"><a href="#_2、vuepress-starter项目中添加-drone-yml文件" class="header-anchor">#</a> 2、vuepress-starter项目中添加.drone.yml文件</h4> <p><code>.drone.yml</code> 是 DroneCI 中的配置文件，定义了持续集成（CI）和持续部署（CD）的管道。它的主要作用包括：</p> <ol><li>定义构建步骤：指定需要执行的步骤，如编译代码、运行测试、构建镜像等。每个步骤可以使用不同的 Docker 镜像。</li> <li>配置工作流：定义构建流程，包括顺序、并行执行、依赖关系等。</li> <li>设置环境变量：为构建过程提供必要的环境变量，可以包括敏感信息如 API 密钥或数据库凭证。</li> <li>管理部署：配置自动化部署步骤，将构建好的应用程序部署到目标环境中。</li> <li>控制触发条件：指定何时触发构建，比如在代码推送、合并请求等事件时。</li></ol> <p>通过 <code>.drone.yml</code> 文件，你可以将构建和部署过程自动化，从而提高开发效率和代码质量。这个文件仅仅需要放在项目的根目录下即可</p> <p><img src="/knowledge_base/assets/img/image-20240827104415274.905b8176.png" alt="image-20240827104415274"></p> <p>配置文件中填入：</p> <div class="language-yml line-numbers-mode"><pre class="language-yml"><code><span class="token key atrule">kind</span><span class="token punctuation">:</span> pipeline
<span class="token key atrule">type</span><span class="token punctuation">:</span> docker
<span class="token key atrule">name</span><span class="token punctuation">:</span> build<span class="token punctuation">-</span>and<span class="token punctuation">-</span>deploy
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><hr> <h4 id="_3、在gitea创建drone仓库"><a href="#_3、在gitea创建drone仓库" class="header-anchor">#</a> 3、在gitea创建drone仓库</h4> <p><img src="/knowledge_base/assets/img/image-20240827104432691.6ee556c0.png" alt="image-20240827104432691"></p> <hr> <h4 id="_4、在gitea上创建应用。"><a href="#_4、在gitea上创建应用。" class="header-anchor">#</a> 4、在gitea上创建应用。</h4> <p>之所以要在 gitea 上创建应用，是因为这些参数需要事先记录下来，后续gitea在与服务器端的 droneCI 进行通信之时，是需要运用到这些参数的。</p> <p><img src="/knowledge_base/assets/img/image-20240827104535815.1256a1d1.png" alt="image-20240827104535815"></p> <p><img src="/knowledge_base/assets/img/image-20240827104557099.d21183df.png" alt="image-20240827104557099"></p> <p><img src="/knowledge_base/assets/img/image-20240827104617954.f98dd021.png" alt="image-20240827104617954"></p> <hr> <h4 id="_5、将本地的vuepress代码推送到gitea中"><a href="#_5、将本地的vuepress代码推送到gitea中" class="header-anchor">#</a> 5、将本地的vuepress代码推送到gitea中</h4> <div class="language- line-numbers-mode"><pre class="language-text"><code>touch README.md
git init
git checkout -b main
git add README.md
git commit -m &quot;first commit&quot;
git remote add origin https://xxxxxxxxxxxxxxxxxxxx/2.git
git push -u origin main
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h2 id="四、服务器环境安装"><a href="#四、服务器环境安装" class="header-anchor">#</a> 四、服务器环境安装</h2> <h4 id="_1、安装nginx"><a href="#_1、安装nginx" class="header-anchor">#</a> 1、安装nginx</h4> <h5 id="_1-1-添加nginx-官方仓库"><a href="#_1-1-添加nginx-官方仓库" class="header-anchor">#</a> 1.1. 添加Nginx 官方仓库</h5> <p>Nginx 提供了自己的官方仓库，你可以直接从中安装 Nginx。首先，下载并安装 Nginx 官方的仓库配置文件：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo dnf install https://nginx.org/packages/centos/7/x86_64/RPMS/nginx-release-centos-1.14-1.el7.ngx.noarch.rpm
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_1-2-安装-nginx"><a href="#_1-2-安装-nginx" class="header-anchor">#</a> 1.2. <strong>安装 Nginx</strong></h5> <p>下载并安装 Nginx：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo dnf install nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_1-3-启动并启用-nginx-服务"><a href="#_1-3-启动并启用-nginx-服务" class="header-anchor">#</a> 1.3. <strong>启动并启用 Nginx 服务</strong></h5> <p>启动 Nginx 服务，并设置为开机自启：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl start nginx
sudo systemctl enable nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_1-4-检查-nginx-状态"><a href="#_1-4-检查-nginx-状态" class="header-anchor">#</a> 1.4. <strong>检查 Nginx 状态</strong></h5> <p>确认 Nginx 是否在运行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl status nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_1-5-配置防火墙"><a href="#_1-5-配置防火墙" class="header-anchor">#</a> 1.5. <strong>配置防火墙</strong></h5> <p>如果使用 <code>firewalld</code>，允许 HTTP 和 HTTPS 流量：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --permanent --add-service=http
sudo firewall-cmd --permanent --add-service=https
sudo firewall-cmd --reload
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="_1-6、更改nginx的配置文件"><a href="#_1-6、更改nginx的配置文件" class="header-anchor">#</a> 1.6、更改nginx的配置文件</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>curl ifconfig.me
nano /etc/nginx/nginx.conf
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><p><img src="/knowledge_base/assets/img/image-20240827104643612.22e2686f.png" alt="image-20240827104643612"></p> <h5 id="_1-7、服务器配置防火墙-添加90端口-可访问"><a href="#_1-7、服务器配置防火墙-添加90端口-可访问" class="header-anchor">#</a> 1.7、服务器配置防火墙，添加90端口，可访问</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo firewall-cmd --permanent --add-port=90/tcp
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_1-9-重新加载或重启-nginx"><a href="#_1-9-重新加载或重启-nginx" class="header-anchor">#</a> 1.9. <strong>重新加载或重启 Nginx</strong></h5> <p>应用更改需要重新加载或重启 Nginx：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl reload nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>如果 <code>reload</code> 不生效，可以使用 <code>restart</code> 命令：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl restart nginx
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2-0检查nginx是否安装成功"><a href="#_2-0检查nginx是否安装成功" class="header-anchor">#</a> 2.0检查nginx是否安装成功</h5> <p>采用ip+90端口，查看是否可以访问到nginx的欢迎页</p> <p><img src="/knowledge_base/assets/img/image-20240827104700604.42a7fa5a.png" alt="image-20240827104700604"></p> <hr> <h4 id="_2、安装docker"><a href="#_2、安装docker" class="header-anchor">#</a> 2、安装docker</h4> <h5 id="_2-1-卸载旧版本-如果存在"><a href="#_2-1-卸载旧版本-如果存在" class="header-anchor">#</a> 2.1. 卸载旧版本（如果存在）</h5> <p>首先，卸载任何旧版本的 Docker（如有）：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo dnf remove docker docker-common docker-selinux docker-engine
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2-2-设置-docker-仓库"><a href="#_2-2-设置-docker-仓库" class="header-anchor">#</a> 2.2. 设置 Docker 仓库</h5> <p>添加 Docker 的官方仓库：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2-3-安装-docker-ce-稳定版本"><a href="#_2-3-安装-docker-ce-稳定版本" class="header-anchor">#</a> 2.3. 安装 Docker CE 稳定版本</h5> <p>更新仓库索引，并安装 Docker CE 稳定版本及其相关工具：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo dnf clean all
sudo dnf makecache
sudo dnf install -y docker-ce docker-ce-cli containerd.io --nobest
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h5 id="_2-4-启动和启用-docker-服务"><a href="#_2-4-启动和启用-docker-服务" class="header-anchor">#</a> 2.4. 启动和启用 Docker 服务</h5> <p>启动 Docker 服务并设置开机自启：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo systemctl start docker
sudo systemctl enable docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h5 id="_2-5-验证-docker-安装"><a href="#_2-5-验证-docker-安装" class="header-anchor">#</a> 2.5. 验证 Docker 安装</h5> <p>检查 Docker 版本以确认安装：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo docker --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2-6、运行-hello-world-容器来验证-docker-是否正确工作"><a href="#_2-6、运行-hello-world-容器来验证-docker-是否正确工作" class="header-anchor">#</a> 2.6、运行 <code>hello-world</code> 容器来验证 Docker 是否正确工作：</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo docker run hello-world
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_2-7、将用户添加到-docker-组"><a href="#_2-7、将用户添加到-docker-组" class="header-anchor">#</a> 2.7、将用户添加到 Docker 组：</h5> <p>备注：如果你希望以非 <code>root</code> 用户身份运行 Docker 命令</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo usermod -aG docker $USER
newgrp docker
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><hr> <h4 id="_3、安装docker-compose"><a href="#_3、安装docker-compose" class="header-anchor">#</a> 3、安装docker-compose</h4> <h5 id="_3-1、使用-curl-命令下载-docker-compose-的最新版本"><a href="#_3-1、使用-curl-命令下载-docker-compose-的最新版本" class="header-anchor">#</a> 3.1、使用 <code>curl</code> 命令下载 Docker Compose 的最新版本：</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo curl -L &quot;https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)&quot; -o /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3-2-设置可执行权限"><a href="#_3-2-设置可执行权限" class="header-anchor">#</a> 3.2. 设置可执行权限</h5> <p>将 Docker Compose 文件设置为可执行：</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo chmod +x /usr/local/bin/docker-compose
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3-3、临时将其添加到-path"><a href="#_3-3、临时将其添加到-path" class="header-anchor">#</a> 3.3、临时将其添加到 <code>$PATH</code>：</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>export PATH=$PATH:/usr/local/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3-4、永久添加-你可以将其加入到-bashrc-文件中"><a href="#_3-4、永久添加-你可以将其加入到-bashrc-文件中" class="header-anchor">#</a> 3.4、永久添加，你可以将其加入到 <code>~/.bashrc</code> 文件中：</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>nano ~/.bashrc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3-5、在文件末尾添加"><a href="#_3-5、在文件末尾添加" class="header-anchor">#</a> 3.5、在文件末尾添加：</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>export PATH=$PATH:/usr/local/bin
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3-6、保存文件并重新加载配置"><a href="#_3-6、保存文件并重新加载配置" class="header-anchor">#</a> 3.6、保存文件并重新加载配置</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>source ~/.bashrc
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_3-7、运行-docker-compose-命令了。验证是否安装成功"><a href="#_3-7、运行-docker-compose-命令了。验证是否安装成功" class="header-anchor">#</a> 3.7、运行 <code>docker-compose</code> 命令了。验证是否安装成功</h5> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker-compose --version
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_4、安装droneci"><a href="#_4、安装droneci" class="header-anchor">#</a> 4、安装DroneCI</h4> <h5 id="_4-1、droneci的配置文件"><a href="#_4-1、droneci的配置文件" class="header-anchor">#</a> 4.1、droneCI的配置文件</h5> <p>注释：这是配置文件的大体格式，具体的需要根据自己的需求，添加和修改部分数据</p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>version: <span class="token string">'3'</span>
services:
  drone-server:
    restart: always
    image: drone/drone:2
    ports:
      - <span class="token string">&quot;80:80&quot;</span>
    volumes:
      - /path/to/drone-data:/var/lib/drone/
    environment:
      - <span class="token assign-left variable">DRONE_GITEA_SERVER</span><span class="token operator">=</span>https://xxxxxx.xxxxxxx.com
      - <span class="token assign-left variable">DRONE_GITEA_CLIENT_ID</span><span class="token operator">=</span>777xxxxxxxxxxxxxx6aa7c
      - <span class="token assign-left variable">DRONE_GITEA_CLIENT_SECRET</span><span class="token operator">=</span>gto_zixxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxz6w5vqp5kxwh6q
      - <span class="token assign-left variable">DRONE_SERVER_HOST</span><span class="token operator">=</span><span class="token number">8</span>.xxx.xx.84
      - <span class="token assign-left variable">DRONE_SERVER_PROTO</span><span class="token operator">=</span>http
      - <span class="token assign-left variable">DRONE_RPC_SECRET</span><span class="token operator">=</span>5831a2eea5c0b5a9f377259c30a63185
      - <span class="token assign-left variable">DRONE_GIT_ALWAYS_AUTH</span><span class="token operator">=</span>true
      - <span class="token assign-left variable">DRONE_GIT_USERNAME</span><span class="token operator">=</span>15xxxxxxx76
      - <span class="token assign-left variable">DRONE_GIT_PASSWORD</span><span class="token operator">=</span>Lxxxxxx6
      - <span class="token assign-left variable">DRONE_USER_CREATE</span><span class="token operator">=</span>username:15xxxxxxx76,admin:true

  drone-runner-docker:
    image: drone/drone-runner-docker:latest
    restart: always
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
    environment:
      - <span class="token assign-left variable">DRONE_RPC_PROTO</span><span class="token operator">=</span>http
      - <span class="token assign-left variable">DRONE_RPC_HOST</span><span class="token operator">=</span><span class="token number">8</span>.xxx.xx.84
      - <span class="token assign-left variable">DRONE_RPC_SECRET</span><span class="token operator">=</span>5831a2eea5c0b5a9f377259c30a63185
      - <span class="token assign-left variable">DRONE_RUNNER_NAME</span><span class="token operator">=</span>drone-runner-docker
      - <span class="token assign-left variable">DRONE_RUNNER_CAPACITY</span><span class="token operator">=</span><span class="token number">2</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br></div></div><h5 id="_4-2、droneci配置文件位置说明"><a href="#_4-2、droneci配置文件位置说明" class="header-anchor">#</a> 4.2、droneci配置文件位置说明</h5> <p><img src="/knowledge_base/assets/img/image-20240827104732692.5917e7ee.png" alt="image-20240827104732692"></p> <p>DRONE_RPC_SECRET用这个命令生成</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>openssl rand -hex 16
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_4-3、dronce配置文件使用说明"><a href="#_4-3、dronce配置文件使用说明" class="header-anchor">#</a> 4.3、dronce配置文件使用说明</h5> <p>进入根目录，创建gcyw文件夹，在文件夹中创建docker-compose.yml文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>#切换到root用户
sudo su
#在根目录下创建gcyw目录
mkdir /gcyw
#创建docker-compose.yml文件
touch docker-compose.yml
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><p>运行docker-compose.yml文件</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>docker-compose up -d
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p>查看droneRunner和droneServer是否启动成功</p> <div class="language- line-numbers-mode"><pre class="language-text"><code>sudo docker ps
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h5 id="_4-4、droneci的配置文件解释"><a href="#_4-4、droneci的配置文件解释" class="header-anchor">#</a> 4.4、droneCi的配置文件解释</h5> <p>这个 <code>docker-compose.yml</code> 文件配置了一个 Drone CI/CD 系统，包括两个主要的服务：<code>drone-server</code> 和 <code>drone-runner-docker</code>。下面是每个部分的详细解释：</p> <h6 id="_4-4-1、drone-server-服务"><a href="#_4-4-1、drone-server-服务" class="header-anchor">#</a> <code>4.4.1、drone-server</code> 服务</h6> <ul><li><p><strong><code>restart: always</code></strong>：表示容器崩溃或宿主机重启后会自动重新启动。</p></li> <li><p><strong><code>image: drone/drone:2</code></strong>：使用 <code>drone/drone</code> 镜像的 2 版。这个镜像包含 Drone 服务器的最新稳定版本。</p></li> <li><p><code>ports</code></p> <p>：</p> <ul><li><code>80:80</code>：将宿主机的 80 端口映射到容器的 80 端口。这使得你可以通过宿主机的 80 端口访问 Drone 服务器。</li></ul></li> <li><p><code>volumes</code></p> <p>：</p> <ul><li><code>/path/to/drone-data:/var/lib/drone/</code>：将宿主机上的 <code>/path/to/drone-data</code> 目录挂载到容器的 <code>/var/lib/drone/</code>。这个目录用于存储 Drone 服务器的数据和配置文件。</li></ul></li> <li><p><code>environment</code></p> <p>：配置了多个环境变量，用于设置 Drone 服务器的行为和连接到 Git 服务器（Gitea）的方式。</p> <ul><li><code>DRONE_GITEA_SERVER</code>：Gitea 服务器的地址。</li> <li><code>DRONE_GITEA_CLIENT_ID</code> 和 <code>DRONE_GITEA_CLIENT_SECRET</code>：用于与 Gitea 进行身份验证的客户端 ID 和秘密。</li> <li><code>DRONE_SERVER_HOST</code> 和 <code>DRONE_SERVER_PROTO</code>：Drone 服务器的地址和协议（HTTP 或 HTTPS）。</li> <li><code>DRONE_RPC_SECRET</code>：用于认证 Drone 服务器和 Runner 之间的通信的秘密。</li> <li><code>DRONE_GIT_ALWAYS_AUTH</code>：强制每次访问 Git 仓库时都进行身份验证。</li> <li><code>DRONE_GIT_USERNAME</code> 和 <code>DRONE_GIT_PASSWORD</code>：用于访问 Git 仓库的用户名和密码。</li> <li><code>DRONE_USER_CREATE</code>：自动创建一个管理员用户，用户名为 <code>15185626476</code>。</li></ul></li></ul> <h6 id="_4-4-2、drone-runner-docker-服务"><a href="#_4-4-2、drone-runner-docker-服务" class="header-anchor">#</a> <code>4.4.2、drone-runner-docker</code> 服务</h6> <ul><li><p><strong><code>image: drone/drone-runner-docker:latest</code></strong>：使用 <code>drone/drone-runner-docker</code> 镜像的最新版本。这个镜像用于运行 Docker 容器中的 Drone Runner。</p></li> <li><p><strong><code>restart: always</code></strong>：表示容器崩溃或宿主机重启后会自动重新启动。</p></li> <li><p><code>volumes</code></p> <p>：</p> <ul><li><code>/var/run/docker.sock:/var/run/docker.sock</code>：将宿主机的 Docker 套接字挂载到容器中。这使得容器可以访问宿主机的 Docker 引擎，从而在 Docker 容器中运行构建任务。</li></ul></li> <li><p><code>environment</code></p> <p>：配置了多个环境变量，用于设置 Drone Runner 的行为。</p> <ul><li><code>DRONE_RPC_PROTO</code> 和 <code>DRONE_RPC_HOST</code>：指定 Drone 服务器的协议和主机地址，以便 Runner 可以与服务器通信。</li> <li><code>DRONE_RPC_SECRET</code>：用于认证 Runner 和服务器之间的通信的秘密，应该与 <code>drone-server</code> 中的设置匹配。</li> <li><code>DRONE_RUNNER_NAME</code>：给 Runner 指定一个名字，这里为 <code>drone-runner-docker</code>。</li> <li><code>DRONE_RUNNER_CAPACITY</code>：设置 Runner 的容量，这里为 2，表示此 Runner 可以并行处理两个构建任务。</li></ul></li></ul> <h6 id="_4-4-5、总结"><a href="#_4-4-5、总结" class="header-anchor">#</a> 4.4.5、总结</h6> <ul><li><strong><code>drone-server</code></strong> 负责管理和协调构建任务，提供 Web 界面和 API。</li> <li><strong><code>drone-runner-docker</code></strong> 负责执行构建任务，在 Docker 容器中运行实际的构建步骤。</li></ul> <p>这两个服务配合工作，共同完成 CI/CD 流程中的自动化构建和部署任务。</p> <h2 id="五、测试"><a href="#五、测试" class="header-anchor">#</a> 五、测试</h2> <h3 id="_1、流程流通性测试"><a href="#_1、流程流通性测试" class="header-anchor">#</a> 1、流程流通性测试</h3> <p><img src="/knowledge_base/assets/img/image-20240827104810499.923824d6.png" alt="image-20240827104810499"></p> <p><img src="/knowledge_base/assets/img/image-20240827104919304.3182ecfd.png" alt="image-20240827104919304"></p> <p><img src="/knowledge_base/assets/img/image-20240827104938245.1a4c9e44.png" alt="image-20240827104938245"></p> <p><img src="/knowledge_base/assets/img/image-20240827104959656.f2f78fbd.png" alt="image-20240827104959656"></p> <p><img src="/knowledge_base/assets/img/image-20240827105022129.0bb5b824.png" alt="image-20240827105022129"></p> <p><img src="/knowledge_base/assets/img/image-20240827105038091.40808ba8.png" alt="image-20240827105038091"></p> <p><img src="/knowledge_base/assets/img/image-20240827105111001.e94af960.png" alt="image-20240827105111001"></p> <p><img src="/knowledge_base/assets/img/image-20240827105125580.725867cb.png" alt="image-20240827105125580"></p> <p><img src="/knowledge_base/assets/img/image-20240827105146699.a01ae6c7.png" alt="image-20240827105146699"></p> <h3 id="_2、项目在服务器构建测试"><a href="#_2、项目在服务器构建测试" class="header-anchor">#</a> 2、项目在服务器构建测试</h3> <p>进入gitea修改.drone.yml文件</p> <p><img src="/knowledge_base/assets/img/image-20240827105206799.affe217a.png" alt="image-20240827105206799"></p> <p>.drone.yml写入如下内容</p> <p><img src="/knowledge_base/assets/img/image-20240827105220397.af05840a.png" alt="image-20240827105220397"></p> <div class="language-bash line-numbers-mode"><pre class="language-bash"><code>kind: pipeline
type: <span class="token function">docker</span>
name: build-and-deploy
volumes:
  - name: node_modules
    host:
      path: /var/lib/drone/node_modules
  - name: vuepress_output
    host:
      path: /var/lib/drone/vuepress_output
steps:
  - name: build-vuepress
    image: node:20.16.0
    volumes:
      - name: node_modules
        path: /drone/src/node_modules
      - name: vuepress_output
        path: /drone/src/docs/.vuepress/dist
    commands:
      - <span class="token builtin class-name">cd</span> /drone/src
      - <span class="token function">npm</span> <span class="token function">install</span>
      - <span class="token function">npm</span> run docs:build
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><p>进入droneCi的服务页，查看构建情况</p> <p><img src="/knowledge_base/assets/img/image-20240827105236527.b1c56ac6.png" alt="image-20240827105236527"></p> <p>进入90端口，访问项目是否构建成功</p> <p><img src="/knowledge_base/assets/img/image-20240827105256040.808065b9.png" alt="image-20240827105256040"></p></div></div> <!----> <div class="page-edit"><div class="edit-link"><a href="https://github.com/XIAOHONGHUB/knowledge_base/edit/master/docs/06.知识库/01.知识库搭建/01.DroneCI博客搭建教程.md" target="_blank" rel="noopener noreferrer">编辑</a> <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></div> <!----> <div class="last-updated"><span class="prefix">上次更新:</span> <span class="time">2024/10/16, 0:10:00</span></div></div> <div class="page-nav-wapper"><div class="page-nav-centre-wrap"><!----> <a href="/knowledge_base/pages/41f87d89089a02af/" class="page-nav-centre page-nav-centre-next"><div class="tooltip">知识上传知识库教程</div></a></div> <div class="page-nav"><p class="inner"><!----> <span class="next"><a href="/knowledge_base/pages/41f87d89089a02af/">知识上传知识库教程</a>→
      </span></p></div></div></div> <!----></main></div> <div class="footer"><!----> 
  Theme by
  <a href="https://github.com/xugaoyi/vuepress-theme-vdoing" target="_blank" title="本站主题">Vdoing</a> 
    | Copyright © 2024-2024
    <span>工诚云网</span></div> <div class="buttons"><div title="返回顶部" class="button blur go-to-top iconfont icon-fanhuidingbu" style="display:none;"></div> <div title="去评论" class="button blur go-to-comment iconfont icon-pinglun" style="display:none;"></div> <div title="主题模式" class="button blur theme-mode-but iconfont icon-zhuti"><ul class="select-box" style="display:none;"><li class="iconfont icon-zidong">
          跟随系统
        </li><li class="iconfont icon-rijianmoshi">
          浅色模式
        </li><li class="iconfont icon-yejianmoshi">
          深色模式
        </li><li class="iconfont icon-yuedu">
          阅读模式
        </li></ul></div></div> <!----> <!----> <!----></div><div class="global-ui"></div></div>
    <script src="/knowledge_base/assets/js/app.abb6159b.js" defer></script><script src="/knowledge_base/assets/js/3.5aff290e.js" defer></script><script src="/knowledge_base/assets/js/2.a12c3dd1.js" defer></script><script src="/knowledge_base/assets/js/9.7865277d.js" defer></script>
  </body>
</html>
