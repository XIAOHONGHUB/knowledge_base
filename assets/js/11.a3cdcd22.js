(window.webpackJsonp=window.webpackJsonp||[]).push([[11],{595:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104036095.1b3a45ec.png"},596:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104106307.7c71fbba.png"},597:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104239322.6b1b1906.png"},598:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104308234.a75ff634.png"},599:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104328730.aeb9f122.png"},600:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104351434.ff494a54.png"},601:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104415274.905b8176.png"},602:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104432691.6ee556c0.png"},603:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104535815.1256a1d1.png"},604:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104557099.d21183df.png"},605:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104617954.f98dd021.png"},606:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104643612.22e2686f.png"},607:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104700604.42a7fa5a.png"},608:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104732692.5917e7ee.png"},609:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104810499.923824d6.png"},610:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104919304.3182ecfd.png"},611:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104938245.1a4c9e44.png"},612:function(s,e,a){s.exports=a.p+"assets/img/image-20240827104959656.f2f78fbd.png"},613:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105022129.0bb5b824.png"},614:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105038091.40808ba8.png"},615:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105111001.e94af960.png"},616:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105125580.725867cb.png"},617:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105146699.a01ae6c7.png"},618:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105206799.affe217a.png"},619:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105220397.af05840a.png"},620:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105236527.b1c56ac6.png"},621:function(s,e,a){s.exports=a.p+"assets/img/image-20240827105256040.808065b9.png"},696:function(s,e,a){"use strict";a.r(e);var t=a(14),r=Object(t.a)({},(function(){var s=this,e=s._self._c;return e("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[e("h1",{attrs:{id:"知识库搭建笔记"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#知识库搭建笔记"}},[s._v("#")]),s._v(" 知识库搭建笔记")]),s._v(" "),e("p",[s._v("时间：2024年8月22日")]),s._v(" "),e("p",[s._v("作者：罗佳鸿")]),s._v(" "),e("p",[s._v("搭建须知：由于docker目前很多的镜像源库在中国已经停止服务了，所以在使用docker拉取droneCI的时候会出现拉取超时的问题。如果项目中不希望使用docker进行应用管理，无需继续往下看。如果执意选择docker安装，在docker拉取镜像超时时，可以去网上多尝试不同的镜像源。目前国内还有部分docker镜像能用。")]),s._v(" "),e("h2",{attrs:{id:"一、环境配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#一、环境配置"}},[s._v("#")]),s._v(" 一、环境配置：")]),s._v(" "),e("table",[e("thead",[e("tr",[e("th",[s._v("名称")]),s._v(" "),e("th",[s._v("版本号")])])]),s._v(" "),e("tbody",[e("tr",[e("td",[s._v("操作系统")]),s._v(" "),e("td",[s._v("openEuler")])]),s._v(" "),e("tr",[e("td",[s._v("docker版本")]),s._v(" "),e("td",[s._v("v26.1.3")])]),s._v(" "),e("tr",[e("td",[s._v("nginx版本")]),s._v(" "),e("td",[s._v("v1.21.5")])]),s._v(" "),e("tr",[e("td",[s._v("docker-compose版本")]),s._v(" "),e("td",[s._v("v2.29.2")])]),s._v(" "),e("tr",[e("td",[s._v("node")]),s._v(" "),e("td",[s._v("v20.16.0")])]),s._v(" "),e("tr",[e("td",[s._v("git")]),s._v(" "),e("td",[s._v("v2.40.0.rc0.windows.1")])])])]),s._v(" "),e("h2",{attrs:{id:"二、知识库运行原理"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#二、知识库运行原理"}},[s._v("#")]),s._v(" 二、知识库运行原理")]),s._v(" "),e("p",[e("img",{attrs:{src:a(595),alt:"image-20240827104036095"}})]),s._v(" "),e("details",{staticClass:"custom-block details"},[e("summary",[s._v("SQL语句释义")]),s._v(" "),e("p",[s._v("知识库采用droneCI为主线技术。")]),s._v(" "),e("p",[s._v("DroneCI 的工作原理是本地代码提交到 Gitea 后，Gitea 通过 webhook 通知 Drone Server。Drone Server 接收到通知后，会触发相应的 pipeline，运行定义好的构建任务。这些任务由 Runner 执行，Runner 会去gitea拉取代码并在指定环境中进行构建和测试。")])]),s._v(" "),e("h2",{attrs:{id:"三、将本地vuepress代码传到gitea仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#三、将本地vuepress代码传到gitea仓库"}},[s._v("#")]),s._v(" 三、将本地vuepress代码传到gitea仓库")]),s._v(" "),e("h4",{attrs:{id:"_1、创建vuepress-starter项目"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、创建vuepress-starter项目"}},[s._v("#")]),s._v(" 1、创建vuepress-starter项目")]),s._v(" "),e("p",[s._v("​\t通过gitbash在本地创建vuepress-starter项目【vuepress的默认项目】，这是自动拉取方式，如果拉取不下来，可以尝试手动拉取，参考地址："),e("a",{attrs:{href:"https://vuepress.vuejs.org/zh/guide/getting-started.html#%E4%BE%9D%E8%B5%96%E7%8E%AF%E5%A2%83",target:"_blank",rel:"noopener noreferrer"}},[s._v("快速上手 | VuePress (vuejs.org)"),e("OutboundLink")],1)]),s._v(" "),e("p",[e("img",{attrs:{src:a(596),alt:"image-20240827104106307"}})]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("npm init vuepress vuepress-starter\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("hr"),s._v(" "),e("p",[e("img",{attrs:{src:a(597),alt:"image-20240827104239322"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(598),alt:"image-20240827104308234"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(599),alt:"image-20240827104328730"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(600),alt:"image-20240827104351434"}})]),s._v(" "),e("h4",{attrs:{id:"_2、vuepress-starter项目中添加-drone-yml文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、vuepress-starter项目中添加-drone-yml文件"}},[s._v("#")]),s._v(" 2、vuepress-starter项目中添加.drone.yml文件")]),s._v(" "),e("p",[e("code",[s._v(".drone.yml")]),s._v(" 是 DroneCI 中的配置文件，定义了持续集成（CI）和持续部署（CD）的管道。它的主要作用包括：")]),s._v(" "),e("ol",[e("li",[s._v("定义构建步骤：指定需要执行的步骤，如编译代码、运行测试、构建镜像等。每个步骤可以使用不同的 Docker 镜像。")]),s._v(" "),e("li",[s._v("配置工作流：定义构建流程，包括顺序、并行执行、依赖关系等。")]),s._v(" "),e("li",[s._v("设置环境变量：为构建过程提供必要的环境变量，可以包括敏感信息如 API 密钥或数据库凭证。")]),s._v(" "),e("li",[s._v("管理部署：配置自动化部署步骤，将构建好的应用程序部署到目标环境中。")]),s._v(" "),e("li",[s._v("控制触发条件：指定何时触发构建，比如在代码推送、合并请求等事件时。")])]),s._v(" "),e("p",[s._v("通过 "),e("code",[s._v(".drone.yml")]),s._v(" 文件，你可以将构建和部署过程自动化，从而提高开发效率和代码质量。这个文件仅仅需要放在项目的根目录下即可")]),s._v(" "),e("p",[e("img",{attrs:{src:a(601),alt:"image-20240827104415274"}})]),s._v(" "),e("p",[s._v("配置文件中填入：")]),s._v(" "),e("div",{staticClass:"language-yml line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-yml"}},[e("code",[e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("kind")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" pipeline\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("type")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" docker\n"),e("span",{pre:!0,attrs:{class:"token key atrule"}},[s._v("name")]),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(":")]),s._v(" build"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("and"),e("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("-")]),s._v("deploy\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("hr"),s._v(" "),e("h4",{attrs:{id:"_3、在gitea创建drone仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、在gitea创建drone仓库"}},[s._v("#")]),s._v(" 3、在gitea创建drone仓库")]),s._v(" "),e("p",[e("img",{attrs:{src:a(602),alt:"image-20240827104432691"}})]),s._v(" "),e("hr"),s._v(" "),e("h4",{attrs:{id:"_4、在gitea上创建应用。"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、在gitea上创建应用。"}},[s._v("#")]),s._v(" 4、在gitea上创建应用。")]),s._v(" "),e("p",[s._v("之所以要在 gitea 上创建应用，是因为这些参数需要事先记录下来，后续gitea在与服务器端的 droneCI 进行通信之时，是需要运用到这些参数的。")]),s._v(" "),e("p",[e("img",{attrs:{src:a(603),alt:"image-20240827104535815"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(604),alt:"image-20240827104557099"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(605),alt:"image-20240827104617954"}})]),s._v(" "),e("hr"),s._v(" "),e("h4",{attrs:{id:"_5、将本地的vuepress代码推送到gitea中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_5、将本地的vuepress代码推送到gitea中"}},[s._v("#")]),s._v(" 5、将本地的vuepress代码推送到gitea中")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('touch README.md\ngit init\ngit checkout -b main\ngit add README.md\ngit commit -m "first commit"\ngit remote add origin https://xxxxxxxxxxxxxxxxxxxx/2.git\ngit push -u origin main\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br")])]),e("h2",{attrs:{id:"四、服务器环境安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#四、服务器环境安装"}},[s._v("#")]),s._v(" 四、服务器环境安装")]),s._v(" "),e("h4",{attrs:{id:"_1、安装nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、安装nginx"}},[s._v("#")]),s._v(" 1、安装nginx")]),s._v(" "),e("h5",{attrs:{id:"_1-1-添加nginx-官方仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-1-添加nginx-官方仓库"}},[s._v("#")]),s._v(" 1.1. 添加Nginx 官方仓库")]),s._v(" "),e("p",[s._v("Nginx 提供了自己的官方仓库，你可以直接从中安装 Nginx。首先，下载并安装 Nginx 官方的仓库配置文件：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo dnf install https://nginx.org/packages/centos/7/x86_64/RPMS/nginx-release-centos-1.14-1.el7.ngx.noarch.rpm\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_1-2-安装-nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-2-安装-nginx"}},[s._v("#")]),s._v(" 1.2. "),e("strong",[s._v("安装 Nginx")])]),s._v(" "),e("p",[s._v("下载并安装 Nginx：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo dnf install nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_1-3-启动并启用-nginx-服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-3-启动并启用-nginx-服务"}},[s._v("#")]),s._v(" 1.3. "),e("strong",[s._v("启动并启用 Nginx 服务")])]),s._v(" "),e("p",[s._v("启动 Nginx 服务，并设置为开机自启：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo systemctl start nginx\nsudo systemctl enable nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"_1-4-检查-nginx-状态"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-4-检查-nginx-状态"}},[s._v("#")]),s._v(" 1.4. "),e("strong",[s._v("检查 Nginx 状态")])]),s._v(" "),e("p",[s._v("确认 Nginx 是否在运行：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo systemctl status nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_1-5-配置防火墙"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-5-配置防火墙"}},[s._v("#")]),s._v(" 1.5. "),e("strong",[s._v("配置防火墙")])]),s._v(" "),e("p",[s._v("如果使用 "),e("code",[s._v("firewalld")]),s._v("，允许 HTTP 和 HTTPS 流量：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo firewall-cmd --permanent --add-service=http\nsudo firewall-cmd --permanent --add-service=https\nsudo firewall-cmd --reload\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h5",{attrs:{id:"_1-6、更改nginx的配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-6、更改nginx的配置文件"}},[s._v("#")]),s._v(" 1.6、更改nginx的配置文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("curl ifconfig.me\nnano /etc/nginx/nginx.conf\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("p",[e("img",{attrs:{src:a(606),alt:"image-20240827104643612"}})]),s._v(" "),e("h5",{attrs:{id:"_1-7、服务器配置防火墙-添加90端口-可访问"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-7、服务器配置防火墙-添加90端口-可访问"}},[s._v("#")]),s._v(" 1.7、服务器配置防火墙，添加90端口，可访问")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo firewall-cmd --permanent --add-port=90/tcp\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_1-9-重新加载或重启-nginx"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1-9-重新加载或重启-nginx"}},[s._v("#")]),s._v(" 1.9. "),e("strong",[s._v("重新加载或重启 Nginx")])]),s._v(" "),e("p",[s._v("应用更改需要重新加载或重启 Nginx：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo systemctl reload nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("如果 "),e("code",[s._v("reload")]),s._v(" 不生效，可以使用 "),e("code",[s._v("restart")]),s._v(" 命令：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo systemctl restart nginx\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_2-0检查nginx是否安装成功"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-0检查nginx是否安装成功"}},[s._v("#")]),s._v(" 2.0检查nginx是否安装成功")]),s._v(" "),e("p",[s._v("采用ip+90端口，查看是否可以访问到nginx的欢迎页")]),s._v(" "),e("p",[e("img",{attrs:{src:a(607),alt:"image-20240827104700604"}})]),s._v(" "),e("hr"),s._v(" "),e("h4",{attrs:{id:"_2、安装docker"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、安装docker"}},[s._v("#")]),s._v(" 2、安装docker")]),s._v(" "),e("h5",{attrs:{id:"_2-1-卸载旧版本-如果存在"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-1-卸载旧版本-如果存在"}},[s._v("#")]),s._v(" 2.1. 卸载旧版本（如果存在）")]),s._v(" "),e("p",[s._v("首先，卸载任何旧版本的 Docker（如有）：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo dnf remove docker docker-common docker-selinux docker-engine\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_2-2-设置-docker-仓库"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-2-设置-docker-仓库"}},[s._v("#")]),s._v(" 2.2. 设置 Docker 仓库")]),s._v(" "),e("p",[s._v("添加 Docker 的官方仓库：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo dnf config-manager --add-repo=https://download.docker.com/linux/centos/docker-ce.repo\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_2-3-安装-docker-ce-稳定版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-3-安装-docker-ce-稳定版本"}},[s._v("#")]),s._v(" 2.3. 安装 Docker CE 稳定版本")]),s._v(" "),e("p",[s._v("更新仓库索引，并安装 Docker CE 稳定版本及其相关工具：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo dnf clean all\nsudo dnf makecache\nsudo dnf install -y docker-ce docker-ce-cli containerd.io --nobest\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br")])]),e("h5",{attrs:{id:"_2-4-启动和启用-docker-服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-4-启动和启用-docker-服务"}},[s._v("#")]),s._v(" 2.4. 启动和启用 Docker 服务")]),s._v(" "),e("p",[s._v("启动 Docker 服务并设置开机自启：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo systemctl start docker\nsudo systemctl enable docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("h5",{attrs:{id:"_2-5-验证-docker-安装"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-5-验证-docker-安装"}},[s._v("#")]),s._v(" 2.5. 验证 Docker 安装")]),s._v(" "),e("p",[s._v("检查 Docker 版本以确认安装：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo docker --version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_2-6、运行-hello-world-容器来验证-docker-是否正确工作"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-6、运行-hello-world-容器来验证-docker-是否正确工作"}},[s._v("#")]),s._v(" 2.6、运行 "),e("code",[s._v("hello-world")]),s._v(" 容器来验证 Docker 是否正确工作：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo docker run hello-world\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_2-7、将用户添加到-docker-组"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2-7、将用户添加到-docker-组"}},[s._v("#")]),s._v(" 2.7、将用户添加到 Docker 组：")]),s._v(" "),e("p",[s._v("备注：如果你希望以非 "),e("code",[s._v("root")]),s._v(" 用户身份运行 Docker 命令")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo usermod -aG docker $USER\nnewgrp docker\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br")])]),e("hr"),s._v(" "),e("h4",{attrs:{id:"_3、安装docker-compose"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3、安装docker-compose"}},[s._v("#")]),s._v(" 3、安装docker-compose")]),s._v(" "),e("h5",{attrs:{id:"_3-1、使用-curl-命令下载-docker-compose-的最新版本"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-1、使用-curl-命令下载-docker-compose-的最新版本"}},[s._v("#")]),s._v(" 3.1、使用 "),e("code",[s._v("curl")]),s._v(" 命令下载 Docker Compose 的最新版本：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v('sudo curl -L "https://github.com/docker/compose/releases/latest/download/docker-compose-$(uname -s)-$(uname -m)" -o /usr/local/bin/docker-compose\n')])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_3-2-设置可执行权限"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-2-设置可执行权限"}},[s._v("#")]),s._v(" 3.2. 设置可执行权限")]),s._v(" "),e("p",[s._v("将 Docker Compose 文件设置为可执行：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo chmod +x /usr/local/bin/docker-compose\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_3-3、临时将其添加到-path"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-3、临时将其添加到-path"}},[s._v("#")]),s._v(" 3.3、临时将其添加到 "),e("code",[s._v("$PATH")]),s._v("：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export PATH=$PATH:/usr/local/bin\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_3-4、永久添加-你可以将其加入到-bashrc-文件中"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-4、永久添加-你可以将其加入到-bashrc-文件中"}},[s._v("#")]),s._v(" 3.4、永久添加，你可以将其加入到 "),e("code",[s._v("~/.bashrc")]),s._v(" 文件中：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("nano ~/.bashrc\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_3-5、在文件末尾添加"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-5、在文件末尾添加"}},[s._v("#")]),s._v(" 3.5、在文件末尾添加：")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("export PATH=$PATH:/usr/local/bin\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_3-6、保存文件并重新加载配置"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-6、保存文件并重新加载配置"}},[s._v("#")]),s._v(" 3.6、保存文件并重新加载配置")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("source ~/.bashrc\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_3-7、运行-docker-compose-命令了。验证是否安装成功"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_3-7、运行-docker-compose-命令了。验证是否安装成功"}},[s._v("#")]),s._v(" 3.7、运行 "),e("code",[s._v("docker-compose")]),s._v(" 命令了。验证是否安装成功")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose --version\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h4",{attrs:{id:"_4、安装droneci"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4、安装droneci"}},[s._v("#")]),s._v(" 4、安装DroneCI")]),s._v(" "),e("h5",{attrs:{id:"_4-1、droneci的配置文件"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-1、droneci的配置文件"}},[s._v("#")]),s._v(" 4.1、droneCI的配置文件")]),s._v(" "),e("p",[s._v("注释：这是配置文件的大体格式，具体的需要根据自己的需求，添加和修改部分数据")]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("version: "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v("'3'")]),s._v("\nservices:\n  drone-server:\n    restart: always\n    image: drone/drone:2\n    ports:\n      - "),e("span",{pre:!0,attrs:{class:"token string"}},[s._v('"80:80"')]),s._v("\n    volumes:\n      - /path/to/drone-data:/var/lib/drone/\n    environment:\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_GITEA_SERVER")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("https://xxxxxx.xxxxxxx.com\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_GITEA_CLIENT_ID")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("777xxxxxxxxxxxxxx6aa7c\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_GITEA_CLIENT_SECRET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("gto_zixxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxz6w5vqp5kxwh6q\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_SERVER_HOST")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".xxx.xx.84\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_SERVER_PROTO")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RPC_SECRET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5831a2eea5c0b5a9f377259c30a63185\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_GIT_ALWAYS_AUTH")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("true\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_GIT_USERNAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("15xxxxxxx76\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_GIT_PASSWORD")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("Lxxxxxx6\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_USER_CREATE")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("username:15xxxxxxx76,admin:true\n\n  drone-runner-docker:\n    image: drone/drone-runner-docker:latest\n    restart: always\n    volumes:\n      - /var/run/docker.sock:/var/run/docker.sock\n    environment:\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RPC_PROTO")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("http\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RPC_HOST")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("8")]),s._v(".xxx.xx.84\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RPC_SECRET")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("5831a2eea5c0b5a9f377259c30a63185\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RUNNER_NAME")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("drone-runner-docker\n      - "),e("span",{pre:!0,attrs:{class:"token assign-left variable"}},[s._v("DRONE_RUNNER_CAPACITY")]),e("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),e("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),s._v("\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br"),e("span",{staticClass:"line-number"},[s._v("23")]),e("br"),e("span",{staticClass:"line-number"},[s._v("24")]),e("br"),e("span",{staticClass:"line-number"},[s._v("25")]),e("br"),e("span",{staticClass:"line-number"},[s._v("26")]),e("br"),e("span",{staticClass:"line-number"},[s._v("27")]),e("br"),e("span",{staticClass:"line-number"},[s._v("28")]),e("br"),e("span",{staticClass:"line-number"},[s._v("29")]),e("br"),e("span",{staticClass:"line-number"},[s._v("30")]),e("br"),e("span",{staticClass:"line-number"},[s._v("31")]),e("br"),e("span",{staticClass:"line-number"},[s._v("32")]),e("br")])]),e("h5",{attrs:{id:"_4-2、droneci配置文件位置说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-2、droneci配置文件位置说明"}},[s._v("#")]),s._v(" 4.2、droneci配置文件位置说明")]),s._v(" "),e("p",[e("img",{attrs:{src:a(608),alt:"image-20240827104732692"}})]),s._v(" "),e("p",[s._v("DRONE_RPC_SECRET用这个命令生成")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("openssl rand -hex 16\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_4-3、dronce配置文件使用说明"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-3、dronce配置文件使用说明"}},[s._v("#")]),s._v(" 4.3、dronce配置文件使用说明")]),s._v(" "),e("p",[s._v("进入根目录，创建gcyw文件夹，在文件夹中创建docker-compose.yml文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("#切换到root用户\nsudo su\n#在根目录下创建gcyw目录\nmkdir /gcyw\n#创建docker-compose.yml文件\ntouch docker-compose.yml\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br")])]),e("p",[s._v("运行docker-compose.yml文件")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("docker-compose up -d\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("p",[s._v("查看droneRunner和droneServer是否启动成功")]),s._v(" "),e("div",{staticClass:"language- line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-text"}},[e("code",[s._v("sudo docker ps\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br")])]),e("h5",{attrs:{id:"_4-4、droneci的配置文件解释"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4、droneci的配置文件解释"}},[s._v("#")]),s._v(" 4.4、droneCi的配置文件解释")]),s._v(" "),e("p",[s._v("这个 "),e("code",[s._v("docker-compose.yml")]),s._v(" 文件配置了一个 Drone CI/CD 系统，包括两个主要的服务："),e("code",[s._v("drone-server")]),s._v(" 和 "),e("code",[s._v("drone-runner-docker")]),s._v("。下面是每个部分的详细解释：")]),s._v(" "),e("h6",{attrs:{id:"_4-4-1、drone-server-服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-1、drone-server-服务"}},[s._v("#")]),s._v(" "),e("code",[s._v("4.4.1、drone-server")]),s._v(" 服务")]),s._v(" "),e("ul",[e("li",[e("p",[e("strong",[e("code",[s._v("restart: always")])]),s._v("：表示容器崩溃或宿主机重启后会自动重新启动。")])]),s._v(" "),e("li",[e("p",[e("strong",[e("code",[s._v("image: drone/drone:2")])]),s._v("：使用 "),e("code",[s._v("drone/drone")]),s._v(" 镜像的 2 版。这个镜像包含 Drone 服务器的最新稳定版本。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("ports")])]),s._v(" "),e("p",[s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("80:80")]),s._v("：将宿主机的 80 端口映射到容器的 80 端口。这使得你可以通过宿主机的 80 端口访问 Drone 服务器。")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("volumes")])]),s._v(" "),e("p",[s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("/path/to/drone-data:/var/lib/drone/")]),s._v("：将宿主机上的 "),e("code",[s._v("/path/to/drone-data")]),s._v(" 目录挂载到容器的 "),e("code",[s._v("/var/lib/drone/")]),s._v("。这个目录用于存储 Drone 服务器的数据和配置文件。")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("environment")])]),s._v(" "),e("p",[s._v("：配置了多个环境变量，用于设置 Drone 服务器的行为和连接到 Git 服务器（Gitea）的方式。")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("DRONE_GITEA_SERVER")]),s._v("：Gitea 服务器的地址。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_GITEA_CLIENT_ID")]),s._v(" 和 "),e("code",[s._v("DRONE_GITEA_CLIENT_SECRET")]),s._v("：用于与 Gitea 进行身份验证的客户端 ID 和秘密。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_SERVER_HOST")]),s._v(" 和 "),e("code",[s._v("DRONE_SERVER_PROTO")]),s._v("：Drone 服务器的地址和协议（HTTP 或 HTTPS）。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_RPC_SECRET")]),s._v("：用于认证 Drone 服务器和 Runner 之间的通信的秘密。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_GIT_ALWAYS_AUTH")]),s._v("：强制每次访问 Git 仓库时都进行身份验证。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_GIT_USERNAME")]),s._v(" 和 "),e("code",[s._v("DRONE_GIT_PASSWORD")]),s._v("：用于访问 Git 仓库的用户名和密码。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_USER_CREATE")]),s._v("：自动创建一个管理员用户，用户名为 "),e("code",[s._v("15185626476")]),s._v("。")])])])]),s._v(" "),e("h6",{attrs:{id:"_4-4-2、drone-runner-docker-服务"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-2、drone-runner-docker-服务"}},[s._v("#")]),s._v(" "),e("code",[s._v("4.4.2、drone-runner-docker")]),s._v(" 服务")]),s._v(" "),e("ul",[e("li",[e("p",[e("strong",[e("code",[s._v("image: drone/drone-runner-docker:latest")])]),s._v("：使用 "),e("code",[s._v("drone/drone-runner-docker")]),s._v(" 镜像的最新版本。这个镜像用于运行 Docker 容器中的 Drone Runner。")])]),s._v(" "),e("li",[e("p",[e("strong",[e("code",[s._v("restart: always")])]),s._v("：表示容器崩溃或宿主机重启后会自动重新启动。")])]),s._v(" "),e("li",[e("p",[e("code",[s._v("volumes")])]),s._v(" "),e("p",[s._v("：")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("/var/run/docker.sock:/var/run/docker.sock")]),s._v("：将宿主机的 Docker 套接字挂载到容器中。这使得容器可以访问宿主机的 Docker 引擎，从而在 Docker 容器中运行构建任务。")])])]),s._v(" "),e("li",[e("p",[e("code",[s._v("environment")])]),s._v(" "),e("p",[s._v("：配置了多个环境变量，用于设置 Drone Runner 的行为。")]),s._v(" "),e("ul",[e("li",[e("code",[s._v("DRONE_RPC_PROTO")]),s._v(" 和 "),e("code",[s._v("DRONE_RPC_HOST")]),s._v("：指定 Drone 服务器的协议和主机地址，以便 Runner 可以与服务器通信。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_RPC_SECRET")]),s._v("：用于认证 Runner 和服务器之间的通信的秘密，应该与 "),e("code",[s._v("drone-server")]),s._v(" 中的设置匹配。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_RUNNER_NAME")]),s._v("：给 Runner 指定一个名字，这里为 "),e("code",[s._v("drone-runner-docker")]),s._v("。")]),s._v(" "),e("li",[e("code",[s._v("DRONE_RUNNER_CAPACITY")]),s._v("：设置 Runner 的容量，这里为 2，表示此 Runner 可以并行处理两个构建任务。")])])])]),s._v(" "),e("h6",{attrs:{id:"_4-4-5、总结"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_4-4-5、总结"}},[s._v("#")]),s._v(" 4.4.5、总结")]),s._v(" "),e("ul",[e("li",[e("strong",[e("code",[s._v("drone-server")])]),s._v(" 负责管理和协调构建任务，提供 Web 界面和 API。")]),s._v(" "),e("li",[e("strong",[e("code",[s._v("drone-runner-docker")])]),s._v(" 负责执行构建任务，在 Docker 容器中运行实际的构建步骤。")])]),s._v(" "),e("p",[s._v("这两个服务配合工作，共同完成 CI/CD 流程中的自动化构建和部署任务。")]),s._v(" "),e("h2",{attrs:{id:"五、测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#五、测试"}},[s._v("#")]),s._v(" 五、测试")]),s._v(" "),e("h3",{attrs:{id:"_1、流程流通性测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_1、流程流通性测试"}},[s._v("#")]),s._v(" 1、流程流通性测试")]),s._v(" "),e("p",[e("img",{attrs:{src:a(609),alt:"image-20240827104810499"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(610),alt:"image-20240827104919304"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(611),alt:"image-20240827104938245"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(612),alt:"image-20240827104959656"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(613),alt:"image-20240827105022129"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(614),alt:"image-20240827105038091"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(615),alt:"image-20240827105111001"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(616),alt:"image-20240827105125580"}})]),s._v(" "),e("p",[e("img",{attrs:{src:a(617),alt:"image-20240827105146699"}})]),s._v(" "),e("h3",{attrs:{id:"_2、项目在服务器构建测试"}},[e("a",{staticClass:"header-anchor",attrs:{href:"#_2、项目在服务器构建测试"}},[s._v("#")]),s._v(" 2、项目在服务器构建测试")]),s._v(" "),e("p",[s._v("进入gitea修改.drone.yml文件")]),s._v(" "),e("p",[e("img",{attrs:{src:a(618),alt:"image-20240827105206799"}})]),s._v(" "),e("p",[s._v(".drone.yml写入如下内容")]),s._v(" "),e("p",[e("img",{attrs:{src:a(619),alt:"image-20240827105220397"}})]),s._v(" "),e("div",{staticClass:"language-bash line-numbers-mode"},[e("pre",{pre:!0,attrs:{class:"language-bash"}},[e("code",[s._v("kind: pipeline\ntype: "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("docker")]),s._v("\nname: build-and-deploy\nvolumes:\n  - name: node_modules\n    host:\n      path: /var/lib/drone/node_modules\n  - name: vuepress_output\n    host:\n      path: /var/lib/drone/vuepress_output\nsteps:\n  - name: build-vuepress\n    image: node:20.16.0\n    volumes:\n      - name: node_modules\n        path: /drone/src/node_modules\n      - name: vuepress_output\n        path: /drone/src/docs/.vuepress/dist\n    commands:\n      - "),e("span",{pre:!0,attrs:{class:"token builtin class-name"}},[s._v("cd")]),s._v(" /drone/src\n      - "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("install")]),s._v("\n      - "),e("span",{pre:!0,attrs:{class:"token function"}},[s._v("npm")]),s._v(" run docs:build\n")])]),s._v(" "),e("div",{staticClass:"line-numbers-wrapper"},[e("span",{staticClass:"line-number"},[s._v("1")]),e("br"),e("span",{staticClass:"line-number"},[s._v("2")]),e("br"),e("span",{staticClass:"line-number"},[s._v("3")]),e("br"),e("span",{staticClass:"line-number"},[s._v("4")]),e("br"),e("span",{staticClass:"line-number"},[s._v("5")]),e("br"),e("span",{staticClass:"line-number"},[s._v("6")]),e("br"),e("span",{staticClass:"line-number"},[s._v("7")]),e("br"),e("span",{staticClass:"line-number"},[s._v("8")]),e("br"),e("span",{staticClass:"line-number"},[s._v("9")]),e("br"),e("span",{staticClass:"line-number"},[s._v("10")]),e("br"),e("span",{staticClass:"line-number"},[s._v("11")]),e("br"),e("span",{staticClass:"line-number"},[s._v("12")]),e("br"),e("span",{staticClass:"line-number"},[s._v("13")]),e("br"),e("span",{staticClass:"line-number"},[s._v("14")]),e("br"),e("span",{staticClass:"line-number"},[s._v("15")]),e("br"),e("span",{staticClass:"line-number"},[s._v("16")]),e("br"),e("span",{staticClass:"line-number"},[s._v("17")]),e("br"),e("span",{staticClass:"line-number"},[s._v("18")]),e("br"),e("span",{staticClass:"line-number"},[s._v("19")]),e("br"),e("span",{staticClass:"line-number"},[s._v("20")]),e("br"),e("span",{staticClass:"line-number"},[s._v("21")]),e("br"),e("span",{staticClass:"line-number"},[s._v("22")]),e("br")])]),e("p",[s._v("进入droneCi的服务页，查看构建情况")]),s._v(" "),e("p",[e("img",{attrs:{src:a(620),alt:"image-20240827105236527"}})]),s._v(" "),e("p",[s._v("进入90端口，访问项目是否构建成功")]),s._v(" "),e("p",[e("img",{attrs:{src:a(621),alt:"image-20240827105256040"}})])])}),[],!1,null,null,null);e.default=r.exports}}]);